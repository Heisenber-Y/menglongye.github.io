<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>my-first-blog | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="游标，存储过程，存储函数，触发器1.游标游标是一种 PL&#x2F;SQL 控制结构;可以对 SQL 语句的处理进行显示控制，便于对表的行数据 逐条进行处理。 游标并不是一个数据库对象，只是存留在内存中  语法： cursor 游标名 is 查询结果集">
<meta property="og:type" content="article">
<meta property="og:title" content="my-first-blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2019&#x2F;11&#x2F;15&#x2F;my-first-blog&#x2F;index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="游标，存储过程，存储函数，触发器1.游标游标是一种 PL&#x2F;SQL 控制结构;可以对 SQL 语句的处理进行显示控制，便于对表的行数据 逐条进行处理。 游标并不是一个数据库对象，只是存留在内存中  语法： cursor 游标名 is 查询结果集">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-11-17T05:45:40.327Z">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-my-first-blog" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/15/my-first-blog/" class="article-date">
  <time datetime="2019-11-15T10:06:35.000Z" itemprop="datePublished">2019-11-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      my-first-blog
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="游标，存储过程，存储函数，触发器"><a href="#游标，存储过程，存储函数，触发器" class="headerlink" title="游标，存储过程，存储函数，触发器"></a>游标，存储过程，存储函数，触发器</h1><h1 id="1-游标"><a href="#1-游标" class="headerlink" title="1.游标"></a>1.游标</h1><p>游标是一种 PL/SQL 控制结构;可以对 SQL 语句的处理进行显示控制，便于对表的行数据 逐条进行处理。<br> 游标并不是一个数据库对象，只是存留在内存中 </p>
<p>语法： cursor 游标名 is 查询结果集</p>
<a id="more"></a>

<p>操作步骤</p>
<ol>
<li>声明游标</li>
<li>打开游标</li>
<li>从游标中取数据 fetch 游标名 into 变量 （游标名%found：找到数据。游标名%notfound：没有找到数据）</li>
<li>关闭游标 close 游标名</li>
</ol>
<p>前言[百度]（<a href="https://www.baidu.com）" target="_blank" rel="noopener">https://www.baidu.com）</a><br>本文简单记录下oracle数据库中，如何用plsql编程、以及存储过程的创建和使用。<br>相关的概念我就不列举了，大家不清楚的可以自行搜索，本篇主要列举实际的sql语法。<br>那plsql编程，大家可以使用windows的命令行，也可以使用工具进行编写调试，我这边主要使用Oracle Sql Developer来举例。</p>
<p>1 plsql编程<br>1.1 程序结构<br>首先说说plsql的程序，可以分为3个部分：声明部分、可执行部分、异常处理部分。其中declare部分用来声明变量或者游标（结果集类型变量），如果程序中没有变量声明则可以省略。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  <span class="comment">--声明变量、游标</span></span><br><span class="line">  <span class="comment">-- 相当于java中的 public class A&#123;&#125;</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">--执行部分，相当于java中的main方法</span></span><br><span class="line">  <span class="comment">--可以进行异常处理</span></span><br><span class="line">  dbms_output.put_line(<span class="string">'hello world'</span>);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>这段程序中，dbms_output是oracle的内置程序包，相当于java中的System.out，而put_line()是调用的方法，相当于println()方法。执行结果为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br></pre></td></tr></table></figure>

<p>那如果是在命令行执行这段程序，则需要在执行程序之前，打开控制台的输出，并在结尾加“/”标识程序已结束，然后回车即可看到打印的结果。</p>
<p>1.2 变量<br>在plsql中，常见的变量分为两大类：<br>1、普通数据类型（char,varchar2,date,number,boolean,long）；<br>2、特殊变量类型（引用型变量、记录型变量）；<br>变量的声明方式为：变量名 变量类型（变量长度） 例如：v_name varchar2(20)</p>
<p>1.2.1 普通变量<br>普通变量的赋值方式有两种：<br>1）使用“:=”直接赋值，比如：v_name :=‘zhangsan’<br>2）语句赋值，语法为：select 值 into 变量名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 声明一个人的信息，姓名、薪水、地址</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  <span class="comment">-- 姓名</span></span><br><span class="line">  v_name <span class="built_in">VARCHAR2</span>(<span class="number">50</span>) := <span class="string">'zhangsan'</span>;</span><br><span class="line">  <span class="comment">-- 薪水</span></span><br><span class="line">  v_sal NUMBER;</span><br><span class="line">  <span class="comment">-- 地址</span></span><br><span class="line">  v_addr VARCHAR2(200);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment">-- 直接赋值</span></span><br><span class="line">  v_sal := <span class="number">10000</span>;</span><br><span class="line">  <span class="comment">-- 语句赋值</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">'中国'</span> <span class="keyword">into</span> v_addr <span class="keyword">from</span> dual;</span><br><span class="line">  <span class="comment">-- 打印变量</span></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE('姓名：' || v_name || '薪水：' || v_sal || '地址：' || v_addr);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>执行结果为：</p>
<p>1.2.2 引用型变量<br>变量的类型和长度取决于表中字段的类型和长度;<br>通过表名.列名%type指定变量的类型和长度，例如：v_name emp.ename%type;</p>
<p>引用型变量的好处：<br>使用普通变量定义方式，需要知道表中列的类型，而使用引用类型，不需要考虑列的类型，使用%type是非常好的编程风格，因为它使得plsql更加灵活，更加适应于对数据库定义的更新。<br>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">"GD_JIANGUAN"</span>.<span class="string">"EMP"</span> </span><br><span class="line">   (	<span class="string">"ENAME"</span> <span class="built_in">VARCHAR2</span>(<span class="number">20</span> <span class="keyword">BYTE</span>), </span><br><span class="line">	<span class="string">"ESAL"</span> <span class="built_in">NUMBER</span>, </span><br><span class="line">	<span class="string">"EADDR"</span> <span class="built_in">VARCHAR2</span>(<span class="number">20</span> <span class="keyword">BYTE</span>), </span><br><span class="line">	<span class="string">"ENO"</span> <span class="built_in">VARCHAR2</span>(<span class="number">20</span> <span class="keyword">BYTE</span>)</span><br><span class="line">   ) ;</span><br><span class="line">   <span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"GD_JIANGUAN"</span>.<span class="string">"EMP"</span>.<span class="string">"ENAME"</span> <span class="keyword">IS</span> <span class="string">'用户名'</span>;</span><br><span class="line">   <span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"GD_JIANGUAN"</span>.<span class="string">"EMP"</span>.<span class="string">"ESAL"</span> <span class="keyword">IS</span> <span class="string">'薪水'</span>;</span><br><span class="line">   <span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"GD_JIANGUAN"</span>.<span class="string">"EMP"</span>.<span class="string">"EADDR"</span> <span class="keyword">IS</span> <span class="string">'地址'</span>;</span><br><span class="line">   <span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"GD_JIANGUAN"</span>.<span class="string">"EMP"</span>.<span class="string">"ENO"</span> <span class="keyword">IS</span> <span class="string">'编号'</span>;</span><br><span class="line"><span class="keyword">Insert</span> <span class="keyword">into</span> emp (ENAME,ESAL,EADDR,ENO) <span class="keyword">values</span> (<span class="string">'张三'</span>,<span class="number">10000</span>,<span class="string">'中国'</span>,<span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">Insert</span> <span class="keyword">into</span> emp (ENAME,ESAL,EADDR,ENO) <span class="keyword">values</span> (<span class="string">'李四'</span>,<span class="number">8000</span>,<span class="string">'美国'</span>,<span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">Insert</span> <span class="keyword">into</span> emp (ENAME,ESAL,EADDR,ENO) <span class="keyword">values</span> (<span class="string">'王五'</span>,<span class="number">12000</span>,<span class="string">'广州'</span>,<span class="string">'3'</span>);</span><br><span class="line"><span class="keyword">Insert</span> <span class="keyword">into</span> emp (ENAME,ESAL,EADDR,ENO) <span class="keyword">values</span> (<span class="string">'赵六'</span>,<span class="number">7800</span>,<span class="string">'深圳'</span>,<span class="string">'4'</span>);</span><br><span class="line"><span class="keyword">Insert</span> <span class="keyword">into</span> emp (ENAME,ESAL,EADDR,ENO) <span class="keyword">values</span> (<span class="string">'钱七'</span>,<span class="number">9000</span>,<span class="string">'上海'</span>,<span class="string">'5'</span>);</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「zyp112」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/zyp112/article/details/82755468</span><br></pre></td></tr></table></figure>





<p>举例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询emp表中赵六的个人信息，打印姓名、薪水和地址</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  <span class="comment">--姓名 声明变量并直接赋值</span></span><br><span class="line">  v_name   emp.ename%<span class="keyword">TYPE</span>;</span><br><span class="line">  <span class="comment">--薪水</span></span><br><span class="line">  v_sal    emp.esal%TYPE;</span><br><span class="line">  <span class="comment">--地址</span></span><br><span class="line">  v_addr   emp.eaddr%TYPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">--查询表中的姓名和薪水并赋值给变量</span></span><br><span class="line">  <span class="comment">--注意查询的字段和赋值的变量的顺序、个数、类型需要一致</span></span><br><span class="line">  <span class="keyword">SELECT</span> ename,esal,eaddr <span class="keyword">INTO</span> v_name,v_sal,v_addr <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> ename = <span class="string">'赵六'</span>;</span><br><span class="line">  <span class="comment">--打印结果</span></span><br><span class="line">  dbms_output.put_line('姓名：' || v_name || ' 薪水：' || v_sal || ' 地址：' || v_addr);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「zyp112」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/zyp112/article/details/82755468</span><br></pre></td></tr></table></figure>

<p>结果为：</p>
<p>1.2.3 记录型变量<br>接收表中的一整行记录，相当于java中的一个对象<br>语法：变量名称 表名%rowtype，例如：v_emp emp%type;<br>如果一张表有几十个字段，程序中需要使用这些字段，那定义一个记录型变量则可以方便的解决这个问题。<br>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询emp表中赵六的个人信息，打印姓名、薪水和地址</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  <span class="comment">--定义记录型变量</span></span><br><span class="line">  v_emp emp%ROWTYPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">--记录型变量默认接收表中的一行数据，不能指定字段</span></span><br><span class="line">  <span class="keyword">SELECT</span> * <span class="keyword">INTO</span> v_emp <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> ename = <span class="string">'赵六'</span>;</span><br><span class="line">  <span class="comment">--打印结果，通过变量名.属性的方式获取变量中的值</span></span><br><span class="line">  dbms_output.put_line('姓名：' || v_emp.ename || ' 薪水：' || v_emp.esal || ' 地址：' || v_emp.eaddr);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「zyp112」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/zyp112/article/details/82755468</span><br></pre></td></tr></table></figure>

<p>结果为：</p>
<p>使用记录型变量常见的问题及注意点：<br>1）记录型变量只能存储一条完整的行数据，不支持存储部分字段</p>
<p>2）返回的行太多，记录型变量也接收不了</p>
<p>1.3 流程控制<br>1.3.1 条件分支<br>条件分支的语法一般为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> 条件<span class="number">1</span> <span class="keyword">then</span> 执行<span class="number">1</span>        </span><br><span class="line">	<span class="keyword">elsif</span> 条件<span class="number">2</span> <span class="keyword">then</span> 执行<span class="number">2</span></span><br><span class="line">	<span class="keyword">else</span> 执行<span class="number">3</span></span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>



<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 判断emp表中记录数是否超过5条，3-5条，小于3条</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  <span class="comment">--声明变量接收emp表中的记录数</span></span><br><span class="line">  v_count <span class="built_in">NUMBER</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">INTO</span> v_count <span class="keyword">FROM</span> emp;</span><br><span class="line">  IF v_count &gt; 5 THEN</span><br><span class="line">    dbms_output.put_line('记录数超过5条，具体数量为：' || v_count);</span><br><span class="line">  ELSIF v_count &gt;= 3 THEN</span><br><span class="line">    dbms_output.put_line('记录数为3~5条，具体数量为：' || v_count);</span><br><span class="line">  ELSE</span><br><span class="line">    dbms_output.put_line('记录数小于3条，具体数量为：' || v_count);</span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「zyp112」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/zyp112/article/details/82755468</span><br></pre></td></tr></table></figure>



<p>结果为：</p>
<p>注意：oracle中所有的字符拼接符都是“||”，而不是“+”。如果报错“数字或值错误”，则检查程序是否使用了“+”号作为拼接符使用。</p>
<p>1.3.2 循环<br>oracle中，循环的方式有3钟，for、while、loop，当然，使用goto语法，也能进行循环下面分别列举这4种循环的用法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- goto循环</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  x <span class="built_in">number</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  x := <span class="number">0</span>;</span><br><span class="line">  &lt;&lt;repeat_loop&gt;&gt; --循环点</span><br><span class="line">  x := x + 1;</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(X);</span><br><span class="line">  IF X &lt; 5 THEN</span><br><span class="line">    GOTO repeat_loop; <span class="comment">--当x的值小于9时,就goto到repeat_loop</span></span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br><span class="line"><span class="comment">--for循环</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  X <span class="built_in">number</span>; <span class="comment">--声明变量</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  x := <span class="number">1</span>; <span class="comment">--给初值</span></span><br><span class="line">  FOR X IN REVERSE 1 .. 10 LOOP</span><br><span class="line">    <span class="comment">--reverse由大到小</span></span><br><span class="line">    DBMS_OUTPUT.PUT_LINE('内:x=' || x);</span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE('<span class="keyword">end</span> <span class="keyword">loop</span>:x=<span class="string">' || X); --x=1</span></span><br><span class="line"><span class="string">END;</span></span><br><span class="line"><span class="string">/</span></span><br><span class="line"><span class="string">--while循环</span></span><br><span class="line"><span class="string">DECLARE</span></span><br><span class="line"><span class="string">  x number;</span></span><br><span class="line"><span class="string">BEGIN</span></span><br><span class="line"><span class="string">  x := 0;</span></span><br><span class="line"><span class="string">  WHILE x &lt; 9 LOOP</span></span><br><span class="line"><span class="string">    x := x + 1;</span></span><br><span class="line"><span class="string">    DBMS_OUTPUT.PUT_LINE('</span>内:x=<span class="string">' || x);</span></span><br><span class="line"><span class="string">  END LOOP;</span></span><br><span class="line"><span class="string">  DBMS_OUTPUT.PUT_LINE('</span>外:x=<span class="string">' || x);</span></span><br><span class="line"><span class="string">END;</span></span><br><span class="line"><span class="string">--loop循环</span></span><br><span class="line"><span class="string">DECLARE</span></span><br><span class="line"><span class="string">  x number;</span></span><br><span class="line"><span class="string">BEGIN</span></span><br><span class="line"><span class="string">  x := 0;</span></span><br><span class="line"><span class="string">  LOOP</span></span><br><span class="line"><span class="string">    x := x + 1;</span></span><br><span class="line"><span class="string">    EXIT WHEN x &gt; 9;</span></span><br><span class="line"><span class="string">    DBMS_OUTPUT.PUT_LINE('</span>内:x=<span class="string">' || x);</span></span><br><span class="line"><span class="string">  END LOOP;</span></span><br><span class="line"><span class="string">  DBMS_OUTPUT.PUT_LINE('</span>外:x=<span class="string">' || x);</span></span><br><span class="line"><span class="string">END;</span></span><br><span class="line"><span class="string">————————————————</span></span><br><span class="line"><span class="string">版权声明：本文为CSDN博主「zyp112」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span></span><br><span class="line"><span class="string">原文链接：https://blog.csdn.net/zyp112/article/details/82755468</span></span><br></pre></td></tr></table></figure>

<p>2 游标<br>2.1 什么是游标<br>游标用于临时存储一个查询返回的多行数据（结果集，类似于java中jdbc连接返回的ResultSet集合），通过遍历游标，可以逐行访问处理该结果集的数据。<br>游标的使用方式：申明 –&gt; 打开 –&gt; 读取 –&gt; 关闭</p>
<p>2.2 语法<br>游标的声明：cursor 游标名[{参数列表}] is 查询语句;<br>游标打开： open 游标名;<br>游标读取：fetch 游标名 into 变量列表;<br>游标关闭：close 游标名;</p>
<p>2.3 游标的属性<br>属性    类型    说明<br>%rowcount    整型    获得fetch语句返回的数据行数<br>%found    布尔型    最近的fetch语句返回一行数据则为真，否则为假<br>%notfound    布尔型    与%found返回值相反<br>%isopen    布尔型    游标已经开启时值为真，否则为假<br>其中%notfound是在游标中找不到元素的时候返回true，通常用来判断退出循环。</p>
<p>2.4 创建和使用<br>2.4.1 不带参数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询EMP表中所有员工姓名和工资，并依次打印出来</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  <span class="comment">-- 声明游标</span></span><br><span class="line">  <span class="keyword">CURSOR</span> C_EMP <span class="keyword">IS</span> <span class="keyword">SELECT</span> ENAME, ESAL <span class="keyword">FROM</span> EMP;</span><br><span class="line">  <span class="comment">--申明变量接收游标中的数据</span></span><br><span class="line">  V_NAME EMP.ENAME%TYPE;</span><br><span class="line">  V_SAL  EMP.ESAL%TYPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">--打开游标</span></span><br><span class="line">  <span class="keyword">OPEN</span> C_EMP;</span><br><span class="line">  <span class="comment">--遍历游标</span></span><br><span class="line">  LOOP</span><br><span class="line">    <span class="comment">-- 获取游标中的数据，如果有的话就赋值给变量</span></span><br><span class="line">    FETCH C_EMP INTO V_NAME, V_SAL;</span><br><span class="line">    EXIT WHEN C_EMP%NOTFOUND;</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE('姓名：' || V_NAME || ' 薪水：' || V_SAL);</span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「zyp112」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/zyp112/article/details/82755468</span><br></pre></td></tr></table></figure>



<p>结果为：</p>
<p>2.4.2 带参数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询EMP表中编号为5的员工姓名和工资，并依次打印出来</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  <span class="comment">-- 声明游标</span></span><br><span class="line">  <span class="keyword">CURSOR</span> C_EMP(V_NO EMP.ENO%<span class="keyword">TYPE</span>) <span class="keyword">IS</span></span><br><span class="line">    <span class="keyword">SELECT</span> ENAME, ESAL <span class="keyword">FROM</span> EMP <span class="keyword">WHERE</span> ENO = V_NO;</span><br><span class="line">  <span class="comment">--申明变量接收游标中的数据</span></span><br><span class="line">  V_NAME EMP.ENAME%TYPE;</span><br><span class="line">  V_SAL  EMP.ESAL%TYPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">--打开游标</span></span><br><span class="line">  <span class="keyword">OPEN</span> C_EMP(<span class="number">5</span>);</span><br><span class="line">  <span class="comment">--遍历游标</span></span><br><span class="line">  LOOP</span><br><span class="line">    <span class="comment">-- 获取游标中的数据，如果有的话就赋值给变量</span></span><br><span class="line">    FETCH C_EMP INTO V_NAME, V_SAL;</span><br><span class="line">    EXIT WHEN C_EMP%NOTFOUND;</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE('姓名：' || V_NAME || ' 薪水：' || V_SAL);</span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「zyp112」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/zyp112/article/details/82755468</span><br></pre></td></tr></table></figure>



<p>结果为：</p>
<p>3 存储过程<br>3.1 概念<br>之前编写的plsql程序可以进行表的操作、判断、循环逻辑处理的工作，但是没有办法重复调用。这可以理解为之前的代码全部编写在了main方法中，是匿名的程序，那在java中可以通过封装对象和方法来解决复用的问题。那plsql是将一个个的程序处理过程存储起来进行复用，那这些被存储起来的plsql程序称之为存储过程，相当于java中的方法。</p>
<p>存储过程的作用：<br>1）在开发程序的过程中，为了一个特定的业务功能，会向数据库进行多次请求查询，需要对数据库进行多次I/O读写，性能比较低，而且数据库的连接关闭是非常耗资源的。如果把这些业务处理放到plsql中，在应用程序中调用plsql就可以做到连接关闭一次数据库就可以实现我们的业务，那将可以大大提升效率。<br>2）oracle官方建议：能够让数据库操作的，就不要放到程序中，在数据库中实现基本不会出现错误，而在程序中可能会出错（如果在数据库中操作数据，有一定的日志恢复等功能）。</p>
<p>3.2 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">procedure</span> 过程名称[&#123;参数列表&#125;] <span class="keyword">is</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> [过程名称];</span><br></pre></td></tr></table></figure>



<p>根据参数的类型，可以分为以下3种：<br>1）不带参数的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">REPLACE</span> <span class="keyword">PROCEDURE</span> p_hello <span class="keyword">is</span></span><br><span class="line">  <span class="comment">--这里声明变量，declare被省略</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">'hello'</span>);</span><br><span class="line"><span class="keyword">end</span> p_hello;</span><br><span class="line">/</span><br><span class="line">exec p_hello;</span><br></pre></td></tr></table></figure>



<p>2）带输入参数的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建一个查询并打印某个员工的姓名和薪水的存储过程，要求调用的时候传入员工的编号，自动在控制台打印</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">PROCEDURE</span> QUERYNAMEANDSAL(I_NO EMP.ENO%<span class="keyword">TYPE</span>) <span class="keyword">AS</span></span><br><span class="line">  <span class="comment">-- 声明变量</span></span><br><span class="line">  V_ENAME EMP.ENAME%<span class="keyword">TYPE</span>;</span><br><span class="line">  V_ESAL  EMP.ESAL%TYPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> ENAME, ESAL <span class="keyword">INTO</span> V_ENAME, V_ESAL <span class="keyword">FROM</span> EMP <span class="keyword">WHERE</span> ENO = I_NO;</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(V_ENAME || ' ' || V_ESAL);</span><br><span class="line"><span class="keyword">END</span> QUERYNAMEANDSAL;</span><br><span class="line">/</span><br><span class="line">exec QUERYNAMEANDSAL(5);</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「zyp112」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/zyp112/article/details/82755468</span><br></pre></td></tr></table></figure>



<p>3）带输入参数和输出参数（返回值）的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建一个查询并打印某个员工薪水的存储过程，要求调用的时候传入员工的编号,程序中获取输出</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">PROCEDURE</span> QUERYNAMEANDSAL02(I_NO <span class="keyword">in</span> EMP.ENO%<span class="keyword">TYPE</span> ,O_SAL <span class="keyword">out</span> EMP.ESAL%<span class="keyword">TYPE</span>) <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> ESAL <span class="keyword">INTO</span> O_SAL <span class="keyword">FROM</span> EMP <span class="keyword">WHERE</span> ENO = I_NO;</span><br><span class="line"><span class="keyword">END</span> QUERYNAMEANDSAL02;</span><br><span class="line">/</span><br><span class="line"><span class="comment">-- 以下程序在java中编写</span></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        Class.forName("oracle.jdbc.driver.OracleDriver");</span><br><span class="line">        String url = "jdbc:oracle:thin:@127.0.0.1:1521:ORCL";</span><br><span class="line">        String userName = "gd_jianguan";</span><br><span class="line">        String userpwd = "gd_jianguan";</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, userName, userpwd);</span><br><span class="line">        //获取语句对象</span><br><span class="line">        String sql = "&#123;call QUERYNAMEANDSAL02(?,?)&#125;";</span><br><span class="line">        CallableStatement <span class="keyword">call</span> = conn.prepareCall(<span class="keyword">sql</span>);</span><br><span class="line">        //设置输入参数</span><br><span class="line">        call.setInt(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">        //注册输出参数</span><br><span class="line">        call.registerOutParameter(<span class="number">2</span>, OracleTypes.DOUBLE);</span><br><span class="line">        //执行存储过程</span><br><span class="line">        call.execute();</span><br><span class="line">        //获取输出参数</span><br><span class="line">        double sal = call.getDouble(<span class="number">2</span>);</span><br><span class="line">        System.out.println("薪水：" + sal);</span><br><span class="line">        //释放资源</span><br><span class="line">        call.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「zyp112」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/zyp112/article/details/82755468</span><br></pre></td></tr></table></figure>

















<h2 id="2-存储过程语法："><a href="#2-存储过程语法：" class="headerlink" title="2.存储过程语法："></a>2.存储过程语法：</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名（参数）</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">sql</span>语句</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> pro_a()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test2;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>调用存储过程：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> pro_a()</span><br></pre></td></tr></table></figure>

<p>2:带参数的存储过程：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @x =<span class="number">1</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">PROCEDURE</span> pro_res1(<span class="keyword">out</span> x <span class="built_in">int</span> )</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">MAX</span>(tid) <span class="keyword">into</span> x <span class="keyword">from</span> test2;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>






      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/15/my-first-blog/" data-id="ck32kuaas00002sujc32f9uam" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/15/%E5%8D%81%E5%A4%A7%E7%BB%8F%E5%85%B8%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          十大经典排序算法
        
      </div>
    </a>
  
  
    <a href="/2019/11/15/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/11/15/%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E4%BA%8C%E5%8F%89%E6%A0%91/">深入学习二叉树</a>
          </li>
        
          <li>
            <a href="/2019/11/15/%E5%8D%81%E5%A4%A7%E7%BB%8F%E5%85%B8%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">十大经典排序算法</a>
          </li>
        
          <li>
            <a href="/2019/11/15/my-first-blog/">my-first-blog</a>
          </li>
        
          <li>
            <a href="/2019/11/15/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>